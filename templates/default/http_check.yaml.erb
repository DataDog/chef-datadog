init_config:
<% if @init_config.key?("ca_certs") -%>
    ca_certs: <%= @init_config["ca_certs"] -%>
<% end -%>

<% excluded_keys = ["name", "username", "password", "tags", "headers"] -%>
instances:
<% @instances.each do |i| -%>
  - name: <%= i['name'] %>
    <% if i.key?('username') && i.key?('password') -%>
    username: <%= i['username'] %>
    password: <%= i['password'] %>
    <% end -%>
    <% (i.keys - excluded_keys).each do |key| -%>
    <%= key %>: <%= i[key] %>
    <% end -%>
    <% if i.key?('tags') -%>
    tags:
      <% i['tags'].each do |k| -%>
      - <%= k %>
      <% end -%>
    <% end -%>
    <% if i.key?('headers') -%>
    headers:
      <% i['headers'].each_pair do |k,v| -%>
        <%= k %>: <%= v %>
      <% end -%>
    <% end -%>
<% end -%>